import{t as e,w as n,C as t,k as r,K as a,f as l}from"./vendor-rc-util-C7GvDjgY.js";import{b as o,h as u,c as i,_ as c,a as d,d as s,e as f,n as v}from"./vendor-@babel-IoAzJ7sT.js";import{u as p,b as h,B as m}from"./vendor-rc-select-u6tt5C5p.js";import{r as g}from"./vendor-react-BVfqOVDk.js";import{a as y,c as b,U as C,T as k}from"./vendor-rc-tree-BVdqpC3W.js";import"./vendor-classnames-C6ZHPJN9.js";import"./vendor-rc-overflow-Kc1Cibad.js";import"./vendor-react-dom-DqUgb2va.js";import"./vendor-rc-resize-observer-CNB7JSb9.js";import"./vendor-rc-motion-BgWqvPg4.js";var E=function(e){return!e||e.disabled||e.disableCheckbox||!1===e.checkable},S=function(e){return null==e};var w=function(){return null},x=["children","value"];function D(n){return e(n).map((function(e){if(!g.isValidElement(e)||!e.type)return null;var n=e,t=n.key,r=n.props,a=r.children,l=r.value,u=i(r,x),c=o({key:t,value:l},u),d=D(a);return d.length&&(c.children=d),c})).filter((function(e){return e}))}function M(e){if(!e)return e;var t=o({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return n(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function I(e){var n=g.useRef();n.current=e;var t=g.useCallback((function(){return n.current.apply(n,arguments)}),[]);return t}function N(e,n,t){return g.useMemo((function(){if(e){if(t){var r=o({id:"id",pId:"pId",rootPId:null},"object"===d(t)?t:{});return function(e,n){var t=n.id,r=n.pId,a=n.rootPId,l=new Map,u=[];return e.forEach((function(e){var n=e[t],r=o(o({},e),{},{key:e.key||n});l.set(n,r)})),l.forEach((function(e){var n=e[r],t=l.get(n);t?(t.children=t.children||[],t.children.push(e)):n!==a&&null!==a||u.push(e)})),u}(e,r)}return e}return D(n)}),[n,t,e])}var L=g.createContext(null),T=g.createContext(null),K={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},V=function(e,n){var l=p(),o=l.prefixCls,i=l.multiple,c=l.searchValue,d=l.toggleOpen,h=l.open,m=l.notFoundContent,y=g.useContext(T),b=y.virtual,S=y.listHeight,w=y.listItemHeight,x=y.listItemScrollOffset,D=y.treeData,M=y.fieldNames,I=y.onSelect,N=y.dropdownMatchSelectWidth,V=y.treeExpandAction,P=y.treeTitleRender,O=y.onPopupScroll,H=y.leftMaxCount,A=y.leafCountOnly,R=y.valueEntities,j=g.useContext(L),W=j.checkable,_=j.checkedKeys,F=j.halfCheckedKeys,U=j.treeExpandedKeys,G=j.treeDefaultExpandAll,z=j.treeDefaultExpandedKeys,B=j.onTreeExpand,J=j.treeIcon,Z=j.showTreeIcon,q=j.switcherIcon,Q=j.treeLine,X=j.treeNodeFilterProp,Y=j.loadData,$=j.treeLoadedKeys,ee=j.treeMotion,ne=j.onTreeLoad,te=j.keyEntities,re=g.useRef(),ae=t((function(){return D}),[h,D],(function(e,n){return n[0]&&e[1]!==n[1]})),le=g.useMemo((function(){return W?{checked:_,halfChecked:F}:null}),[W,_,F]);g.useEffect((function(){var e;h&&!i&&_.length&&(null===(e=re.current)||void 0===e||e.scrollTo({key:_[0]}))}),[h]);var oe=function(e){e.preventDefault()},ue=function(e,n){var t=n.node;W&&E(t)||(I(t.key,{selected:!_.includes(t.key)}),i||d(!1))},ie=g.useState(z),ce=s(ie,2),de=ce[0],se=ce[1],fe=g.useState(null),ve=s(fe,2),pe=ve[0],he=ve[1],me=g.useMemo((function(){return U?u(U):c?pe:de}),[de,pe,U,c]),ge=String(c).toLowerCase(),ye=function(e){return!!ge&&String(e[X]).toLowerCase().includes(ge)};g.useEffect((function(){c&&he(function(e,n){var t=[];return function e(r){r.forEach((function(r){var a=r[n.children];a&&(t.push(r[n.value]),e(a))}))}(e),t}(D,M))}),[c]);var be=g.useState((function(){return new Map})),Ce=s(be,2),ke=Ce[0],Ee=Ce[1];g.useEffect((function(){H&&Ee(new Map)}),[H]);var Se=r((function(e){var n=e[M.value];return!_.includes(n)&&(null!==H&&(H<=0||!(!A||!H)&&function(e){var n=e[M.value];if(!ke.has(n)){var t=R.get(n);if(0===(t.children||[]).length)ke.set(n,!1);else{var r=t.children.filter((function(e){return!e.node.disabled&&!e.node.disableCheckbox&&!_.includes(e.node[M.value])})).length;ke.set(n,r>H)}}return ke.get(n)}(e)))})),we=function e(n){var t,r=v(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!a.disabled&&!1!==a.selectable){if(!c)return a;if(ye(a))return a;if(a[M.children]){var l=e(a[M.children]);if(l)return l}}}}catch(o){r.e(o)}finally{r.f()}return null},xe=g.useState(null),De=s(xe,2),Me=De[0],Ie=De[1],Ne=te[Me];g.useEffect((function(){if(h){var e,n=null;n=i||!_.length||c?(e=we(ae))?e[M.value]:null:_[0],Ie(n)}}),[h,c]),g.useImperativeHandle(n,(function(){var e;return{scrollTo:null===(e=re.current)||void 0===e?void 0:e.scrollTo,onKeyDown:function(e){var n;switch(e.which){case a.UP:case a.DOWN:case a.LEFT:case a.RIGHT:null===(n=re.current)||void 0===n||n.onKeyDown(e);break;case a.ENTER:if(Ne){var t=Se(Ne.node),r=(null==Ne?void 0:Ne.node)||{},l=r.selectable,o=r.value,u=r.disabled;!1===l||u||t||ue(0,{node:{key:Me},selected:!_.includes(o)})}break;case a.ESC:d(!1)}},onKeyUp:function(){}}}));var Le=t((function(){return!c}),[c,U||de],(function(e,n){var t=s(e,1)[0],r=s(n,2),a=r[0],l=r[1];return t!==a&&!(!a&&!l)}))?Y:null;if(0===ae.length)return g.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:oe},m);var Te={fieldNames:M};return $&&(Te.loadedKeys=$),me&&(Te.expandedKeys=me),g.createElement("div",{onMouseDown:oe},Ne&&h&&g.createElement("span",{style:K,"aria-live":"assertive"},Ne.node.value),g.createElement(C.Provider,{value:{nodeDisabled:Se}},g.createElement(k,f({ref:re,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:ae,height:S,itemHeight:w,itemScrollOffset:x,virtual:!1!==b&&!1!==N,multiple:i,icon:J,showIcon:Z,switcherIcon:q,showLine:Q,loadData:Le,motion:ee,activeKey:Me,checkable:W,checkStrictly:!0,checkedKeys:le,selectedKeys:W?[]:_,defaultExpandAll:G,titleRender:P},Te,{onActiveChange:Ie,onSelect:ue,onCheck:ue,onExpand:function(e){se(e),he(e),B&&B(e)},onLoad:ne,filterTreeNode:ye,expandAction:V,onScroll:O}))))},P=g.forwardRef(V),O="SHOW_ALL",H="SHOW_PARENT",A="SHOW_CHILD";function R(e,n,t,r){var a=new Set(e);return n===A?e.filter((function(e){var n=t[e];return!(n&&n.children&&n.children.some((function(e){var n=e.node;return a.has(n[r.value])}))&&n.children.every((function(e){var n=e.node;return E(n)||a.has(n[r.value])})))})):n===H?e.filter((function(e){var n=t[e],r=n?n.parent:null;return!r||E(r.node)||!a.has(r.key)})):e}var j=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];var W=g.forwardRef((function(e,t){var r,a,v=e.id,p=e.prefixCls,C=void 0===p?"rc-tree-select":p,k=e.value,E=e.defaultValue,x=e.onChange,D=e.onSelect,K=e.onDeselect,V=e.searchValue,H=e.inputValue,W=e.onSearch,_=e.autoClearSearchValue,F=void 0===_||_,U=e.filterTreeNode,G=e.treeNodeFilterProp,z=void 0===G?"value":G,B=e.showCheckedStrategy,J=e.treeNodeLabelProp,Z=e.multiple,q=e.treeCheckable,Q=e.treeCheckStrictly,X=e.labelInValue,Y=e.maxCount,$=e.fieldNames,ee=e.treeDataSimpleMode,ne=e.treeData,te=e.children,re=e.loadData,ae=e.treeLoadedKeys,le=e.onTreeLoad,oe=e.treeDefaultExpandAll,ue=e.treeExpandedKeys,ie=e.treeDefaultExpandedKeys,ce=e.onTreeExpand,de=e.treeExpandAction,se=e.virtual,fe=e.listHeight,ve=void 0===fe?200:fe,pe=e.listItemHeight,he=void 0===pe?20:pe,me=e.listItemScrollOffset,ge=void 0===me?0:me,ye=e.onDropdownVisibleChange,be=e.dropdownMatchSelectWidth,Ce=void 0===be||be,ke=e.treeLine,Ee=e.treeIcon,Se=e.showTreeIcon,we=e.switcherIcon,xe=e.treeMotion,De=e.treeTitleRender,Me=e.onPopupScroll,Ie=i(e,j),Ne=h(v),Le=q&&!Q,Te=q||Q,Ke=Q||X,Ve=Te||Z,Pe=l(E,{value:k}),Oe=s(Pe,2),He=Oe[0],Ae=Oe[1],Re=g.useMemo((function(){return q?B||A:O}),[B,q]),je=g.useMemo((function(){return function(e){var n=e||{},t=n.label,r=n.value;return{_title:t?[t]:["title","label"],value:r||"value",key:r||"value",children:n.children||"children"}}($)}),[JSON.stringify($)]),We=l("",{value:void 0!==V?V:H,postState:function(e){return e||""}}),_e=s(We,2),Fe=_e[0],Ue=_e[1],Ge=N(ne,te,ee),ze=function(e,n){return g.useMemo((function(){return b(e,{fieldNames:n,initWrapper:function(e){return o(o({},e),{},{valueEntities:new Map})},processEntity:function(e,t){var r=e.node[n.value];t.valueEntities.set(r,e)}})}),[e,n])}(Ge,je),Be=ze.keyEntities,Je=ze.valueEntities,Ze=g.useCallback((function(e){var n=[],t=[];return e.forEach((function(e){Je.has(e)?t.push(e):n.push(e)})),{missingRawValues:n,existRawValues:t}}),[Je]),qe=function(e,n,t){var r=t.fieldNames,a=t.treeNodeFilterProp,l=t.filterTreeNode,u=r.children;return g.useMemo((function(){if(!n||!1===l)return e;var t="function"==typeof l?l:function(e,t){return String(t[a]).toUpperCase().includes(n.toUpperCase())};return function e(r){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.reduce((function(r,l){var i=l[u],d=a||t(n,M(l)),s=e(i||[],d);return(d||s.length)&&r.push(o(o({},l),{},c({isLeaf:void 0},u,s))),r}),[])}(e)}),[e,n,u,a,l])}(Ge,Fe,{fieldNames:je,treeNodeFilterProp:z,filterTreeNode:U}),Qe=g.useCallback((function(e){if(e){if(J)return e[J];for(var n=je._title,t=0;t<n.length;t+=1){var r=e[n[t]];if(void 0!==r)return r}}}),[je,J]),Xe=g.useCallback((function(e){var n=function(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}(e);return n.map((function(e){return function(e){return!e||"object"!==d(e)}(e)?{value:e}:e}))}),[]),Ye=g.useCallback((function(e){return Xe(e).map((function(e){var n,t,r=e.label,a=e.value,l=e.halfChecked,o=Je.get(a);if(o)r=De?De(o.node):null!==(t=r)&&void 0!==t?t:Qe(o.node),n=o.node.disabled;else if(void 0===r){r=Xe(He).find((function(e){return e.value===a})).label}return{label:r,value:a,halfChecked:l,disabled:n}}))}),[Je,Qe,Xe,He]),$e=g.useMemo((function(){return Xe(null===He?[]:He)}),[Xe,He]),en=g.useMemo((function(){var e=[],n=[];return $e.forEach((function(t){t.halfChecked?n.push(t):e.push(t)})),[e,n]}),[$e]),nn=s(en,2),tn=nn[0],rn=nn[1],an=g.useMemo((function(){return tn.map((function(e){return e.value}))}),[tn]),ln=function(e,n,t,r){return g.useMemo((function(){var a=function(e){return e.map((function(e){return e.value}))},l=a(e),o=a(n),i=l.filter((function(e){return!r[e]})),c=l,d=o;if(t){var s=y(l,!0,r);c=s.checkedKeys,d=s.halfCheckedKeys}return[Array.from(new Set([].concat(u(i),u(c)))),d]}),[e,n,t,r])}(tn,rn,Le,Be),on=s(ln,2),un=on[0],cn=on[1],dn=g.useMemo((function(){var e=R(un,Re,Be,je).map((function(e){var n,t;return null!==(n=null===(t=Be[e])||void 0===t||null===(t=t.node)||void 0===t?void 0:t[je.value])&&void 0!==n?n:e})).map((function(e){var n=tn.find((function(n){return n.value===e})),t=X?null==n?void 0:n.label:null==De?void 0:De(n);return{value:e,label:t}})),n=Ye(e),t=n[0];return!Ve&&t&&S(t.value)&&S(t.label)?[]:n.map((function(e){var n;return o(o({},e),{},{label:null!==(n=e.label)&&void 0!==n?n:e.value})}))}),[je,Ve,un,tn,Ye,Re,Be]),sn=(r=dn,a=g.useRef({valueLabels:new Map}),g.useMemo((function(){var e=a.current.valueLabels,n=new Map,t=r.map((function(t){var r=t.value,a=t.label,l=null!=a?a:e.get(r);return n.set(r,l),o(o({},t),{},{label:l})}));return a.current.valueLabels=n,[t]}),[r])),fn=s(sn,1)[0],vn=g.useMemo((function(){return!Ve||"SHOW_CHILD"!==Re&&!Q&&q?null:Y}),[Y,Ve,Q,Re,q]),pn=I((function(e,t,r){var a=R(e,Re,Be,je);if(!(vn&&a.length>vn)){var l=Ye(e);if(Ae(l),F&&Ue(""),x){var o=e;Le&&(o=a.map((function(e){var n=Je.get(e);return n?n.node[je.value]:e})));var i=t||{triggerValue:void 0,selected:void 0},c=i.triggerValue,d=i.selected,s=o;if(Q){var f=rn.filter((function(e){return!o.includes(e.value)}));s=[].concat(u(s),u(f))}var v=Ye(s),p={preValue:tn,triggerValue:c},h=!0;(Q||"selection"===r&&!d)&&(h=!1),function(e,t,r,a,l,o){var u=null,i=null;function c(){i||(i=[],function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.map((function(n,c){var d="".concat(a,"-").concat(c),s=n[o.value],f=r.includes(s),v=e(n[o.children]||[],d,f),p=g.createElement(w,n,v.map((function(e){return e.node})));if(t===s&&(u=p),f){var h={pos:d,node:p,children:v};return l||i.push(h),h}return null})).filter((function(e){return e}))}(a),i.sort((function(e,n){var t=e.node.props.value,a=n.node.props.value;return r.indexOf(t)-r.indexOf(a)})))}Object.defineProperty(e,"triggerNode",{get:function(){return n(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),c(),u}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return n(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),c(),l?i:i.map((function(e){return e.node}))}})}(p,c,e,Ge,h,je),Te?p.checked=d:p.selected=d;var m=Ke?v:v.map((function(e){return e.value}));x(Ve?m:m[0],Ke?null:v.map((function(e){return e.label})),p)}}})),hn=g.useCallback((function(e,n){var t,r=n.selected,a=n.source,l=Be[e],o=null==l?void 0:l.node,i=null!==(t=null==o?void 0:o[je.value])&&void 0!==t?t:e;if(Ve){var c=r?[].concat(u(an),[i]):un.filter((function(e){return e!==i}));if(Le){var d,s=Ze(c),f=s.missingRawValues,v=s.existRawValues.map((function(e){return Je.get(e).key}));if(r)d=y(v,!0,Be).checkedKeys;else d=y(v,{halfCheckedKeys:cn},Be).checkedKeys;c=[].concat(u(f),u(d.map((function(e){return Be[e].node[je.value]}))))}pn(c,{selected:r,triggerValue:i},a||"option")}else pn([i],{selected:!0,triggerValue:i},"option");r||!Ve?null==D||D(i,M(o)):null==K||K(i,M(o))}),[Ze,Je,Be,je,Ve,an,pn,Le,D,K,un,cn,Y]),mn=g.useCallback((function(e){if(ye){var t={};Object.defineProperty(t,"documentClickClose",{get:function(){return n(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ye(e,t)}}),[ye]),gn=I((function(e,n){var t=e.map((function(e){return e.value}));"clear"!==n.type?n.values.length&&hn(n.values[0].value,{selected:!1,source:"selection"}):pn(t,{},"selection")})),yn=g.useMemo((function(){return{virtual:se,dropdownMatchSelectWidth:Ce,listHeight:ve,listItemHeight:he,listItemScrollOffset:ge,treeData:qe,fieldNames:je,onSelect:hn,treeExpandAction:de,treeTitleRender:De,onPopupScroll:Me,leftMaxCount:void 0===Y?null:Y-fn.length,leafCountOnly:"SHOW_CHILD"===Re&&!Q&&!!q,valueEntities:Je}}),[se,Ce,ve,he,ge,qe,je,hn,de,De,Me,Y,fn.length,Re,Q,q,Je]),bn=g.useMemo((function(){return{checkable:Te,loadData:re,treeLoadedKeys:ae,onTreeLoad:le,checkedKeys:un,halfCheckedKeys:cn,treeDefaultExpandAll:oe,treeExpandedKeys:ue,treeDefaultExpandedKeys:ie,onTreeExpand:ce,treeIcon:Ee,treeMotion:xe,showTreeIcon:Se,switcherIcon:we,treeLine:ke,treeNodeFilterProp:z,keyEntities:Be}}),[Te,re,ae,le,un,cn,oe,ue,ie,ce,Ee,xe,Se,we,ke,z,Be]);return g.createElement(T.Provider,{value:yn},g.createElement(L.Provider,{value:bn},g.createElement(m,f({ref:t},Ie,{id:Ne,prefixCls:C,mode:Ve?"multiple":void 0,displayValues:fn,onDisplayValuesChange:gn,searchValue:Fe,onSearch:function(e){Ue(e),null==W||W(e)},OptionList:P,emptyOptions:!Ge.length,onDropdownVisibleChange:mn,dropdownMatchSelectWidth:Ce}))))}));W.TreeNode=w,W.SHOW_ALL=O,W.SHOW_PARENT=H,W.SHOW_CHILD=A;export{W as G,O as S,w as T,H as a,A as b};
