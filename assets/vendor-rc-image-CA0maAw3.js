import{_ as e,b as n,d as o,c as t,e as r,h as a,a as i}from"./vendor-@babel-IoAzJ7sT.js";import{c}from"./vendor-classnames-C6ZHPJN9.js";import{K as l,D as s,B as u,N as f,O as m,f as d,P as v}from"./vendor-rc-util-C7GvDjgY.js";import{r as p,R as g}from"./vendor-react-BVfqOVDk.js";import{D as h}from"./vendor-rc-dialog-zVS1A8Uw.js";import{P as C}from"./vendor-@rc-component-Dsuwcs3B.js";import{C as b}from"./vendor-rc-motion-BgWqvPg4.js";var y=p.createContext(null),w=function(o){var t=o.visible,r=o.maskTransitionName,a=o.getContainer,i=o.prefixCls,s=o.rootClassName,u=o.icons,f=o.countRender,m=o.showSwitch,d=o.showProgress,v=o.current,g=o.transform,h=o.count,w=o.scale,x=o.minScale,R=o.maxScale,k=o.closeIcon,E=o.onActive,S=o.onClose,N=o.onZoomIn,T=o.onZoomOut,I=o.onRotateRight,Y=o.onRotateLeft,P=o.onFlipX,X=o.onFlipY,M=o.onReset,z=o.toolbarRender,Z=o.zIndex,L=o.image,j=p.useContext(y),O=u.rotateLeft,D=u.rotateRight,F=u.zoomIn,W=u.zoomOut,H=u.close,A=u.left,V=u.right,B=u.flipX,G=u.flipY,K="".concat(i,"-operations-operation");p.useEffect((function(){var e=function(e){e.keyCode===l.ESC&&S()};return t&&window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t]);var U=function(e,n){e.preventDefault(),e.stopPropagation(),E(n)},_=p.useCallback((function(n){var o=n.type,t=n.disabled,r=n.onClick,a=n.icon;return p.createElement("div",{key:o,className:c(K,"".concat(i,"-operations-operation-").concat(o),e({},"".concat(i,"-operations-operation-disabled"),!!t)),onClick:r},a)}),[K,i]),q=m?_({icon:A,onClick:function(e){return U(e,-1)},type:"prev",disabled:0===v}):void 0,J=m?_({icon:V,onClick:function(e){return U(e,1)},type:"next",disabled:v===h-1}):void 0,Q=_({icon:G,onClick:X,type:"flipY"}),$=_({icon:B,onClick:P,type:"flipX"}),ee=_({icon:O,onClick:Y,type:"rotateLeft"}),ne=_({icon:D,onClick:I,type:"rotateRight"}),oe=_({icon:W,onClick:T,type:"zoomOut",disabled:w<=x}),te=_({icon:F,onClick:N,type:"zoomIn",disabled:w===R}),re=p.createElement("div",{className:"".concat(i,"-operations")},Q,$,ee,ne,oe,te);return p.createElement(b,{visible:t,motionName:r},(function(o){var t=o.className,r=o.style;return p.createElement(C,{open:!0,getContainer:null!=a?a:document.body},p.createElement("div",{className:c("".concat(i,"-operations-wrapper"),t,s),style:n(n({},r),{},{zIndex:Z})},null===k?null:p.createElement("button",{className:"".concat(i,"-close"),onClick:S},k||H),m&&p.createElement(p.Fragment,null,p.createElement("div",{className:c("".concat(i,"-switch-left"),e({},"".concat(i,"-switch-left-disabled"),0===v)),onClick:function(e){return U(e,-1)}},A),p.createElement("div",{className:c("".concat(i,"-switch-right"),e({},"".concat(i,"-switch-right-disabled"),v===h-1)),onClick:function(e){return U(e,1)}},V)),p.createElement("div",{className:"".concat(i,"-footer")},d&&p.createElement("div",{className:"".concat(i,"-progress")},f?f(v+1,h):p.createElement("bdi",null,"".concat(v+1," / ").concat(h))),z?z(re,n(n({icons:{prevIcon:q,nextIcon:J,flipYIcon:Q,flipXIcon:$,rotateLeftIcon:ee,rotateRightIcon:ne,zoomOutIcon:oe,zoomInIcon:te},actions:{onActive:E,onFlipY:X,onFlipX:P,onRotateLeft:Y,onRotateRight:I,onZoomOut:T,onZoomIn:N,onReset:M,onClose:S},transform:g},j?{current:v,total:h}:{}),{},{image:L})):re)))}))},x={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function R(n,o,t,r){var a=o+t,i=(t-r)/2;if(t>r){if(o>0)return e({},n,i);if(o<0&&a<r)return e({},n,-i)}else if(o<0||a>r)return e({},n,o<0?i:-i);return{}}function k(e,o,t,r){var a=f(),i=a.width,c=a.height,l=null;return e<=i&&o<=c?l={x:0,y:0}:(e>i||o>c)&&(l=n(n({},R("x",t,e,i)),R("y",r,o,c))),l}function E(e){var n=e.src,t=e.isCustomPlaceholder,r=e.fallback,a=p.useState(t?"loading":"normal"),i=o(a,2),c=i[0],l=i[1],s=p.useRef(!1),u="error"===c;p.useEffect((function(){var e=!0;return function(e){return new Promise((function(n){if(e){var o=document.createElement("img");o.onerror=function(){return n(!1)},o.onload=function(){return n(!0)},o.src=e}else n(!1)}))}(n).then((function(n){!n&&e&&l("error")})),function(){e=!1}}),[n]),p.useEffect((function(){t&&!s.current?l("loading"):u&&l("normal")}),[n]);var f=function(){l("normal")};return[function(e){s.current=!1,"loading"===c&&null!=e&&e.complete&&(e.naturalWidth||e.naturalHeight)&&(s.current=!0,f())},u&&r?{src:r}:{onLoad:f,src:n},c]}function S(e,n){var o=e.x-n.x,t=e.y-n.y;return Math.hypot(o,t)}function N(e,t,r,a,i,c,l){var s=i.rotate,u=i.scale,f=i.x,d=i.y,v=p.useState(!1),g=o(v,2),h=g[0],C=g[1],b=p.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),y=function(e){b.current=n(n({},b.current),e)};return p.useEffect((function(){var e;return r&&t&&(e=m(window,"touchmove",(function(e){return e.preventDefault()}),{passive:!1})),function(){var n;null===(n=e)||void 0===n||n.remove()}}),[r,t]),{isTouching:h,onTouchStart:function(e){if(t){e.stopPropagation(),C(!0);var n=e.touches,o=void 0===n?[]:n;o.length>1?y({point1:{x:o[0].clientX,y:o[0].clientY},point2:{x:o[1].clientX,y:o[1].clientY},eventType:"touchZoom"}):y({point1:{x:o[0].clientX-f,y:o[0].clientY-d},eventType:"move"})}},onTouchMove:function(e){var n=e.touches,t=void 0===n?[]:n,r=b.current,a=r.point1,i=r.point2,s=r.eventType;if(t.length>1&&"touchZoom"===s){var u={x:t[0].clientX,y:t[0].clientY},f={x:t[1].clientX,y:t[1].clientY},m=function(e,n,o,t){var r=S(e,o),a=S(n,t);if(0===r&&0===a)return[e.x,e.y];var i=r/(r+a);return[e.x+i*(n.x-e.x),e.y+i*(n.y-e.y)]}(a,i,u,f),d=o(m,2),v=d[0],p=d[1],g=S(u,f)/S(a,i);l(g,"touchZoom",v,p,!0),y({point1:u,point2:f,eventType:"touchZoom"})}else"move"===s&&(c({x:t[0].clientX-a.x,y:t[0].clientY-a.y},"move"),y({eventType:"move"}))},onTouchEnd:function(){if(r){if(h&&C(!1),y({eventType:"none"}),a>u)return c({x:0,y:0,scale:a},"touchZoom");var o=e.current.offsetWidth*u,t=e.current.offsetHeight*u,i=e.current.getBoundingClientRect(),l=i.left,f=i.top,m=s%180!=0,d=k(m?t:o,m?o:t,l,f);d&&c(n({},d),"dragRebound")}}}}var T=["fallback","src","imgRef"],I=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],Y=function(e){var n=e.fallback,a=e.src,i=e.imgRef,c=t(e,T),l=E({src:a,fallback:n}),s=o(l,2),u=s[0],f=s[1];return g.createElement("img",r({ref:function(e){i.current=e,u(e)}},c,f))},P=function(a){var i=a.prefixCls,d=a.src,v=a.alt,C=a.imageInfo,b=a.fallback,R=a.movable,E=void 0===R||R,S=a.onClose,T=a.visible,P=a.icons,X=void 0===P?{}:P,M=a.rootClassName,z=a.closeIcon,Z=a.getContainer,L=a.current,j=void 0===L?0:L,O=a.count,D=void 0===O?1:O,F=a.countRender,W=a.scaleStep,H=void 0===W?.5:W,A=a.minScale,V=void 0===A?1:A,B=a.maxScale,G=void 0===B?50:B,K=a.transitionName,U=void 0===K?"zoom":K,_=a.maskTransitionName,q=void 0===_?"fade":_,J=a.imageRender,Q=a.imgCommonProps,$=a.toolbarRender,ee=a.onTransform,ne=a.onChange,oe=t(a,I),te=p.useRef(),re=p.useContext(y),ae=re&&D>1,ie=re&&D>=1,ce=p.useState(!0),le=o(ce,2),se=le[0],ue=le[1],fe=function(e,t,r,a){var i=p.useRef(null),c=p.useRef([]),l=p.useState(x),m=o(l,2),d=m[0],v=m[1],g=function(e,o){null===i.current&&(c.current=[],i.current=u((function(){v((function(e){var t=e;return c.current.forEach((function(e){t=n(n({},t),e)})),i.current=null,null==a||a({transform:t,action:o}),t}))}))),c.current.push(n(n({},d),e))};return{transform:d,resetTransform:function(e){v(x),s(x,d)||null==a||a({transform:x,action:e})},updateTransform:g,dispatchZoomChange:function(n,o,a,i,c){var l=e.current,s=l.width,u=l.height,m=l.offsetWidth,v=l.offsetHeight,p=l.offsetLeft,h=l.offsetTop,C=n,b=d.scale*n;b>r?(b=r,C=r/d.scale):b<t&&(C=(b=c?b:t)/d.scale);var y=null!=a?a:innerWidth/2,w=null!=i?i:innerHeight/2,x=C-1,R=x*s*.5,k=x*u*.5,E=x*(y-d.x-p),S=x*(w-d.y-h),N=d.x-(E-R),T=d.y-(S-k);if(n<1&&1===b){var I=m*b,Y=v*b,P=f(),X=P.width,M=P.height;I<=X&&Y<=M&&(N=0,T=0)}g({x:N,y:T,scale:b},o)}}}(te,V,G,ee),me=fe.transform,de=fe.resetTransform,ve=fe.updateTransform,pe=fe.dispatchZoomChange,ge=function(e,t,r,a,i,c,l){var s=i.rotate,u=i.scale,f=i.x,d=i.y,v=p.useState(!1),g=o(v,2),h=g[0],C=g[1],b=p.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),y=function(e){r&&h&&c({x:e.pageX-b.current.diffX,y:e.pageY-b.current.diffY},"move")},w=function(){if(r&&h){C(!1);var o=b.current,t=o.transformX,a=o.transformY;if(f===t||d===a)return;var i=e.current.offsetWidth*u,l=e.current.offsetHeight*u,m=e.current.getBoundingClientRect(),v=m.left,p=m.top,g=s%180!=0,y=k(g?l:i,g?i:l,v,p);y&&c(n({},y),"dragRebound")}};return p.useEffect((function(){var e,n,o,r;if(t){o=m(window,"mouseup",w,!1),r=m(window,"mousemove",y,!1);try{window.top!==window.self&&(e=m(window.top,"mouseup",w,!1),n=m(window.top,"mousemove",y,!1))}catch(a){}}return function(){var t,a,i,c;null===(t=o)||void 0===t||t.remove(),null===(a=r)||void 0===a||a.remove(),null===(i=e)||void 0===i||i.remove(),null===(c=n)||void 0===c||c.remove()}}),[r,h,f,d,s,t]),{isMoving:h,onMouseDown:function(e){t&&0===e.button&&(e.preventDefault(),e.stopPropagation(),b.current={diffX:e.pageX-f,diffY:e.pageY-d,transformX:f,transformY:d},C(!0))},onMouseMove:y,onMouseUp:w,onWheel:function(e){if(r&&0!=e.deltaY){var n=Math.abs(e.deltaY/100),o=1+Math.min(n,1)*a;e.deltaY>0&&(o=1/o),l(o,"wheel",e.clientX,e.clientY)}}}}(te,E,T,H,me,ve,pe),he=ge.isMoving,Ce=ge.onMouseDown,be=ge.onWheel,ye=N(te,E,T,V,me,ve,pe),we=ye.isTouching,xe=ye.onTouchStart,Re=ye.onTouchMove,ke=ye.onTouchEnd,Ee=me.rotate,Se=me.scale,Ne=c(e({},"".concat(i,"-moving"),he));p.useEffect((function(){se||ue(!0)}),[se]);var Te=function(e){var n=j+e;!Number.isInteger(n)||n<0||n>D-1||(ue(!1),de(e<0?"prev":"next"),null==ne||ne(n,j))},Ie=function(e){T&&ae&&(e.keyCode===l.LEFT?Te(-1):e.keyCode===l.RIGHT&&Te(1))};p.useEffect((function(){var e=m(window,"keydown",Ie,!1);return function(){e.remove()}}),[T,ae,j]);var Ye=g.createElement(Y,r({},Q,{width:a.width,height:a.height,imgRef:te,className:"".concat(i,"-img"),alt:v,style:{transform:"translate3d(".concat(me.x,"px, ").concat(me.y,"px, 0) scale3d(").concat(me.flipX?"-":"").concat(Se,", ").concat(me.flipY?"-":"").concat(Se,", 1) rotate(").concat(Ee,"deg)"),transitionDuration:(!se||we)&&"0s"},fallback:b,src:d,onWheel:be,onMouseDown:Ce,onDoubleClick:function(e){T&&(1!==Se?ve({x:0,y:0,scale:1},"doubleClick"):pe(1+H,"doubleClick",e.clientX,e.clientY))},onTouchStart:xe,onTouchMove:Re,onTouchEnd:ke,onTouchCancel:ke})),Pe=n({url:d,alt:v},C);return g.createElement(g.Fragment,null,g.createElement(h,r({transitionName:U,maskTransitionName:q,closable:!1,keyboard:!0,prefixCls:i,onClose:S,visible:T,classNames:{wrapper:Ne},rootClassName:M,getContainer:Z},oe,{afterClose:function(){de("close")}}),g.createElement("div",{className:"".concat(i,"-img-wrapper")},J?J(Ye,n({transform:me,image:Pe},re?{current:j}:{})):Ye)),g.createElement(w,{visible:T,transform:me,maskTransitionName:q,closeIcon:z,getContainer:Z,prefixCls:i,rootClassName:M,icons:X,countRender:F,showSwitch:ae,showProgress:ie,current:j,count:D,scale:Se,minScale:V,maxScale:G,toolbarRender:$,onActive:Te,onZoomIn:function(){pe(1+H,"zoomIn")},onZoomOut:function(){pe(1/(1+H),"zoomOut")},onRotateRight:function(){ve({rotate:Ee+90},"rotateRight")},onRotateLeft:function(){ve({rotate:Ee-90},"rotateLeft")},onFlipX:function(){ve({flipX:!me.flipX},"flipX")},onFlipY:function(){ve({flipY:!me.flipY},"flipY")},onClose:S,onReset:function(){de("reset")},zIndex:void 0!==oe.zIndex?oe.zIndex+1:void 0,image:Pe}))},X=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];var M=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],z=["src"],Z=0;var L=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],j=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],O=function(a){var l=a.src,s=a.alt,u=a.onPreviewClose,f=a.prefixCls,m=void 0===f?"rc-image":f,g=a.previewPrefixCls,h=void 0===g?"".concat(m,"-preview"):g,C=a.placeholder,b=a.fallback,w=a.width,x=a.height,R=a.style,k=a.preview,S=void 0===k||k,N=a.className,T=a.onClick,I=a.onError,Y=a.wrapperClassName,M=a.wrapperStyle,z=a.rootClassName,O=t(a,L),D=C&&!0!==C,F="object"===i(S)?S:{},W=F.src,H=F.visible,A=void 0===H?void 0:H,V=F.onVisibleChange,B=void 0===V?u:V,G=F.getContainer,K=void 0===G?void 0:G,U=F.mask,_=F.maskClassName,q=F.movable,J=F.icons,Q=F.scaleStep,$=F.minScale,ee=F.maxScale,ne=F.imageRender,oe=F.toolbarRender,te=t(F,j),re=null!=W?W:l,ae=d(!!A,{value:A,onChange:B}),ie=o(ae,2),ce=ie[0],le=ie[1],se=E({src:l,isCustomPlaceholder:D,fallback:b}),ue=o(se,3),fe=ue[0],me=ue[1],de=ue[2],ve=p.useState(null),pe=o(ve,2),ge=pe[0],he=pe[1],Ce=p.useContext(y),be=!!S,ye=c(m,Y,z,e({},"".concat(m,"-error"),"error"===de)),we=p.useMemo((function(){var e={};return X.forEach((function(n){void 0!==a[n]&&(e[n]=a[n])})),e}),X.map((function(e){return a[e]}))),xe=function(e,n){var t=p.useState((function(){return String(Z+=1)})),r=o(t,1)[0],a=p.useContext(y),i={data:n,canPreview:e};return p.useEffect((function(){if(a)return a.register(r,i)}),[]),p.useEffect((function(){a&&a.register(r,i)}),[e,n]),r}(be,p.useMemo((function(){return n(n({},we),{},{src:re})}),[re,we]));return p.createElement(p.Fragment,null,p.createElement("div",r({},O,{className:ye,onClick:be?function(e){var n=v(e.target),o=n.left,t=n.top;Ce?Ce.onPreview(xe,re,o,t):(he({x:o,y:t}),le(!0)),null==T||T(e)}:T,style:n({width:w,height:x},M)}),p.createElement("img",r({},we,{className:c("".concat(m,"-img"),e({},"".concat(m,"-img-placeholder"),!0===C),N),style:n({height:x},R),ref:fe},me,{width:w,height:x,onError:I})),"loading"===de&&p.createElement("div",{"aria-hidden":"true",className:"".concat(m,"-placeholder")},C),U&&be&&p.createElement("div",{className:c("".concat(m,"-mask"),_),style:{display:"none"===(null==R?void 0:R.display)?"none":void 0}},U)),!Ce&&be&&p.createElement(P,r({"aria-hidden":!ce,visible:ce,prefixCls:h,onClose:function(){le(!1),he(null)},mousePosition:ge,src:re,alt:s,imageInfo:{width:w,height:x},fallback:b,getContainer:K,icons:J,movable:q,scaleStep:Q,minScale:$,maxScale:ee,rootClassName:z,imageRender:ne,imgCommonProps:we,toolbarRender:oe},te)))};O.PreviewGroup=function(c){var l,s=c.previewPrefixCls,u=void 0===s?"rc-image-preview":s,f=c.children,m=c.icons,v=void 0===m?{}:m,g=c.items,h=c.preview,C=c.fallback,b="object"===i(h)?h:{},w=b.visible,x=b.onVisibleChange,R=b.getContainer,k=b.current,E=b.movable,S=b.minScale,N=b.maxScale,T=b.countRender,I=b.closeIcon,Y=b.onChange,Z=b.onTransform,L=b.toolbarRender,j=b.imageRender,O=t(b,M),D=function(t){var r=p.useState({}),i=o(r,2),c=i[0],l=i[1],s=p.useCallback((function(o,t){return l((function(r){return n(n({},r),{},e({},o,t))})),function(){l((function(e){var t=n({},e);return delete t[o],t}))}}),[]);return[p.useMemo((function(){return t?t.map((function(e){if("string"==typeof e)return{data:{src:e}};var n={};return Object.keys(e).forEach((function(o){["src"].concat(a(X)).includes(o)&&(n[o]=e[o])})),{data:n}})):Object.keys(c).reduce((function(e,n){var o=c[n],t=o.canPreview,r=o.data;return t&&e.push({data:r,id:n}),e}),[])}),[t,c]),s,!!t]}(g),F=o(D,3),W=F[0],H=F[1],A=F[2],V=d(0,{value:k}),B=o(V,2),G=B[0],K=B[1],U=p.useState(!1),_=o(U,2),q=_[0],J=_[1],Q=(null===(l=W[G])||void 0===l?void 0:l.data)||{},$=Q.src,ee=t(Q,z),ne=d(!!w,{value:w,onChange:function(e,n){null==x||x(e,n,G)}}),oe=o(ne,2),te=oe[0],re=oe[1],ae=p.useState(null),ie=o(ae,2),ce=ie[0],le=ie[1],se=p.useCallback((function(e,n,o,t){var r=A?W.findIndex((function(e){return e.data.src===n})):W.findIndex((function(n){return n.id===e}));K(r<0?0:r),re(!0),le({x:o,y:t}),J(!0)}),[W,A]);p.useEffect((function(){te?q||K(0):J(!1)}),[te]);var ue=p.useMemo((function(){return{register:H,onPreview:se}}),[H,se]);return p.createElement(y.Provider,{value:ue},f,p.createElement(P,r({"aria-hidden":!te,movable:E,visible:te,prefixCls:u,closeIcon:I,onClose:function(){re(!1),le(null)},mousePosition:ce,imgCommonProps:ee,src:$,fallback:C,icons:v,minScale:S,maxScale:N,getContainer:R,current:G,count:W.length,countRender:T,onTransform:Z,toolbarRender:L,imageRender:j,onChange:function(e,n){K(e),null==Y||Y(e,n)}},O)))};export{O as I};
