import{c as e,f as a,a as t,b as r,d as s}from"./vendor-redux-yWZUFdlJ.js";import{a as o,s as i}from"./utils-Bq9pMUYH.js";import{p as n,a as c,s as l}from"./vendor-redux-persist-qGyRo9vF.js";const d=e({name:"auth",initialState:{isLoginModalOpen:!1},reducers:{openLoginModal:e=>{e.isLoginModalOpen=!0},closeLoginModal:e=>{e.isLoginModalOpen=!1}}}),{openLoginModal:u,closeLoginModal:R}=d.actions,p=d.reducer,g="application/json;charset=UTF-8",m=a({baseUrl:"http://localhost:3000",prepareHeaders:e=>{const a=i.localStorage.getItem("token");return a&&e.set("Authorization","Bearer ".concat(a)),e},timeout:1e4}),f=t({reducerPath:"api",baseQuery:async(e,a,t)=>{const r={...e,headers:{"content-type":g,...e.headers}};let s=await m(r,a,t);const i=s.error,n=(c=i)?"TIMEOUT_ERROR"===c.status?{flag:!0,maxRetries:3}:"PARSING_ERROR"===c.status&&"number"==typeof c.originalStatus&&c.originalStatus>=500?{flag:!0,maxRetries:5}:"PARSING_ERROR"===c.status&&[429,409].includes(c.originalStatus)?{flag:!0,maxRetries:2}:{flag:!1,maxRetries:0}:{flag:!1,maxRetries:0};var c;if(n.flag){const r=n.maxRetries;let c=1;for(;c<=r;){const r=Math.min(1e3*2**c,3e4);if(await o(r),s=await m(e,a,t),!i)break;c++}}if(i)return s;const l=s.data;return 0!==l.code?(localStorage.removeItem("token"),a.dispatch(u(null)),{error:{status:"CUSTOM_ERROR",data:l}}):0!==l.code?{error:{status:"CUSTOM_ERROR",data:l}}:{data:l}},refetchOnReconnect:!0,refetchOnFocus:!0,endpoints:()=>({})}),h=s({reducer:c({key:"root",storage:l,whitelist:["counter"]},r({auth:p,[f.reducerPath]:f.reducer})),middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE"]}}).concat(f.middleware)}),O=n(h);export{O as p,h as s};
